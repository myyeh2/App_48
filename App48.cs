
// ***  時頻數值計算(Precisely Time-Frequency Numerical Computations)  ***
// 微分方程式 : M(t) * yh''(t) + C(t) * yh'(t) + K(t) * yh(t) = dh 
//(多空間多階之齊次微分方程式，求得系統或狀態矩陣 A，再求得 A * Q = Q * D)
// 稱此法為 : 實數與複數矩陣轉換( Real And Complex Matrix Transform )   
// 本求解法可對應於 Laplace、 Fourier、 Z Transform 或是 捲積積分法等等。 

// 假設已知 M(t), K(t), C(t)，再求得隨時間變化的頻率(*** 即系統矩陣 A 之
// 複數特徵值中的虛數值  ***)。
// M(t) = { {19, -1.5, -2+13.3*sin(0.85*t)}, {-1, 15, 0},      
// {-10-2.7*cos(1.3*t), -3, 27}      } 
// K(t) = { {60, -8, -2-332*sin(1.37*t)},    {-16, 180, -120}, 
// {-20, -100+579*cos(0.24*t), 300}  } 
// C(t) = { {35, -1-13.2*sin(0.35t), -0.5},  {-1.5, 40, -1.5}, 
// {-1.2+22.5*cos(1.95*t), -1.5, 75} }
// 系統矩陣 A 的特徵值與特徵向量，為系統的潛在特性，並在系統受到
// 外力時，才會顯現出來。

// 若要求得系統的訊號響應值[Signal Response]，應由實際量測的初始值或
// 是邊界值，求得複數係數向量dh。
// 再依據如下推導的公式求得。(初始值和邊界值分別參見App_6J和App_6M儲存庫)
// [yh''(t) | yh'(t)] = A * [yh'(t) | yh(t)]。  "|"是垂直合併運算子。
// [yh'(t) | yh(t)] = Hexp(D, Q, t) *  dh 。
// A * Q = Q * D  => A = Q * D * Qi 。  
// D為複數特徵值矩陣，Q為複數特徵向量矩陣，Qi為Q之逆矩陣，Hexp(D, Q, t)和dh分別
// 爲複數矩陣和向量。
// [y'(t) | y(t)] = [yh'(t) | yh(t)] + [yp'(t) | yp(t) ] 


using System;
using Matrix_0; 

namespace ConsoleApp48
{
    internal class Program
    {
        static void Main(string[] args)
        {

// 建構初始矩陣 M、K、C。
double[,] M0 = 
    { {19, -1.5, -2}, {-1, 15, 0},      {-10, -3, 27}    };
double[,] K0 = 
    { {60, -8, -2},   {-16, 180, -120}, {-20, -100, 300} };
double[,] C0 = 
    { {35, -1, -0.5}, {-1.5, 40, -1.5}, {-1.2, -1.5, 75} };

// 轉爲SMS型態之矩陣(好處是可使用矩陣的運算子)。
ReMatrix M = new ReMatrix(M0); 
ReMatrix K = new ReMatrix(K0);
ReMatrix C = new ReMatrix(C0); 

// 狀態響應。速度，變位，加速度。(t = 20秒) 
double step = 1.0;
int iRow = (int)(20 / step + 1); 

int m = M.Row; 
int r = 2; 
int iColD = m * r + 1; 

CxMatrix CxVal = new CxMatrix(iRow, iColD); 
ReMatrix ReVal = new ReMatrix(iRow, iColD);

// 時間軸(t-axis)之計算 : 
for (int i = 0; i != iRow; i++)
{
    double t = step * i; 

    // 建構 M、k、C 為變數 t 矩陣。
    double[,] M1 = { {0, 0, 13.3*Math.Sin(0.85*t)},  {0, 0, 0}, 
        {-2.7*Math.Cos(1.3*t), 0, 0}  };
	double[,] K1 = { {0, 0, -332*Math.Sin(1.37*t)},  {0, 0, 0}, 
        {0, 579*Math.Cos(0.24*t), 0}  };
	double[,] C1 = { {0, -13.2*Math.Sin(0.35*t), 0}, {0, 0, 0}, 
        {22.5*Math.Cos(1.95*t), 0, 0} };

	// M(t)=M+(ReMatrix)M1; K(t)=K+(ReMatrix)K1; C(t)=C+(ReMatrix)C1;
	M += (ReMatrix)M1;
	K += (ReMatrix)K1;
	C += (ReMatrix)C1; 

    // 隨時間變化的系統(狀態)矩陣 A。  
    MKCMatrix mkc = new MKCMatrix(M, K, C);
    ReMatrix A = mkc.Matrix; 

    // 隨時間變化的系統特徵值矩陣 D 
    EIG eig = new EIG(A);
    CxMatrix D = eig.CxMatrixD;   

    // 將時間轉爲單一的複數值(Complex Scalar)，
    // 再轉爲C1X1的複數矩陣(Complex Matrix)。
    CxScalar cxScalar = new CxScalar(t, 0); 
    CxMatrix cxMatrix = new CxMatrix(cxScalar); 

    // 隨時間變化的特徵值矩陣。
    CxVal[i, 0] =  cxMatrix; 
    CxVal[i, 1] = D[0, 0]; 
    CxVal[i, 2] = D[1, 1]; 
    CxVal[i, 3] = D[2, 2]; 
    CxVal[i, 4] = D[3, 3]; 
    CxVal[i, 5] = D[4, 4];
    CxVal[i, 6] = D[5, 5]; 

    // 隨時間變化的角矩陣。 
    double[,] tMatrix = { {t} };
    ReVal[i, 0] = (ReMatrix)tMatrix; 
    ReVal[i, 1] = D[0, 0].Im;  
    ReVal[i, 2] = D[1, 1].Im;  
    ReVal[i, 3] = D[2, 2].Im;  
    ReVal[i, 4] = D[3, 3].Im;  
    ReVal[i, 5] = D[4, 4].Im;  
    ReVal[i, 6] = D[5, 5].Im;  
}

Console.WriteLine("\n***  時間(設為複數值，計有一組)，" + 
    "特徵值(計有六組)，合計共有七組複數值  ***"); 
Console.WriteLine("\n{0}\n", new PR(CxVal)); 

Console.WriteLine("\n***  時間(計有一組)，特徵值的虛" + 
    "數值(計有六組)，合計共有七組實數值 ***"); 
Console.WriteLine("  (特徵值的虛數值即角頻率，係依據特徵值" + 
    "的絕對值[模數 Modulus]，由大致小排序而成)");
Console.WriteLine("\n{0}\n", new PR(ReVal)); 

Console.WriteLine("\n時間序列:  t\n{0}\n", new PR4(ReVal, 0)); 
Console.WriteLine("\n角頻率序列w0\n{0}\n", new PR4(ReVal, 1)); 
Console.WriteLine("\n角頻率序列w1\n{0}\n", new PR4(ReVal, 2)); 
Console.WriteLine("\n角頻率序列w2\n{0}\n", new PR4(ReVal, 3)); 
Console.WriteLine("\n角頻率序列w3\n{0}\n", new PR4(ReVal, 4)); 
Console.WriteLine("\n角頻率序列w4\n{0}\n", new PR4(ReVal, 5)); 
Console.WriteLine("\n角頻率序列w5\n{0}\n", new PR4(ReVal, 6)); 

        }
    }
}

/*輸出結果如下 : 
***  時間(設為複數值，計有一組)，特徵值(計有六組)，合計共有七組複數值  ***
  0.00000 +   0.00000i,   -3.21988 +   3.37745i,   -3.21988 -   3.37745i,
  0.34355 +   3.61083i,    0.34355 -   3.61083i,   -0.92621 +   1.52681i,
 -0.92621 -   1.52681i
  1.00000 +   0.00000i,   -3.49561 +   2.87514i,   -3.49561 -   2.87514i,
  1.52214 +   3.58851i,    1.52214 -   3.58851i,   -1.16587 +   1.95302i,
 -1.16587 -   1.95302i
  2.00000 +   0.00000i,   -3.77991 +   2.98608i,   -3.77991 -   2.98608i,
  1.91092 +   3.42431i,    1.91092 -   3.42431i,   -1.06189 +   2.20875i,
 -1.06189 -   2.20875i
  3.00000 +   0.00000i,   -3.47421 +   3.34401i,   -3.47421 -   3.34401i,
  2.06396 +   3.78510i,    2.06396 -   3.78510i,   -1.09093 +   1.81984i,
 -1.09093 -   1.81984i
  4.00000 +   0.00000i,   -3.48623 +   3.70145i,   -3.48623 -   3.70145i,
  1.98893 +   3.90537i,    1.98893 -   3.90537i,   -1.00603 +   1.45004i,
 -1.00603 -   1.45004i
  5.00000 +   0.00000i,   -4.11146 +   3.77624i,   -4.11146 -   3.77624i,
  2.09078 +   3.97058i,    2.09078 -   3.97058i,   -0.98601 +   1.74462i,
 -0.98601 -   1.74462i
  6.00000 +   0.00000i,   -4.96305 +   3.81551i,   -4.96305 -   3.81551i,
  2.47131 +   4.26442i,    2.47131 -   4.26442i,   -0.96842 +   2.05116i,
 -0.96842 -   2.05116i
  7.00000 +   0.00000i,   -5.09309  +   4.02288i,  -5.09309 -   4.02288i,
  2.27333 +   4.49039i,    2.27333  -   4.49039i,  -0.93997 +   1.95020i,
 -0.93997 -   1.95020i
  8.00000 +   0.00000i,   -4.34736 +   4.21289i,   -4.34736 -   4.21289i,
  1.87158 +   4.25208i,    1.87158 -   4.25208i,   -0.91078 +   1.59671i,
 -0.91078 -   1.59671i
  9.00000 +   0.00000i,   -3.69977 +   3.86498i,   -3.69977 -   3.86498i,
  1.77905 +   3.90293i,    1.77905 -   3.90293i,   -0.95020 +   1.48003i,
 -0.95020 -   1.48003i
 10.00000 +   0.00000i,   -3.20907 +   3.26497i,   -3.20907 -   3.26497i,
  2.08552 +   3.50364i,    2.08552 -   3.50364i,   -1.11760 +   1.80711i,
 -1.11760 -   1.80711i
 11.00000 +   0.00000i,   -3.12689 +   2.81192i,   -3.12689 -   2.81192i,
  1.80788 +   3.06483i,    1.80788 -   3.06483i,   -1.22332 +   2.11202i,
 -1.22332 -   2.11202i
 12.00000 +   0.00000i,   -2.77481 +   3.06109i,   -2.77481 -   3.06109i,
  0.94221 +   3.09674i,    0.94221 -   3.09674i,   -1.09811 +   1.77316i,
 -1.09811 -   1.77316i
 13.00000 +   0.00000i,   -2.08277 +   3.29191i,   -2.08277 -   3.29191i,
 -0.60032 +   3.27430i,   -0.60032 -   3.27430i,   -0.58513 +   1.33906i,
 -0.58513 -   1.33906i
  4.00000 +   0.00000i,   -1.42937 +   4.61481i,   -1.42937 -   4.61481i,
 -3.83242 +   0.00000i,   -0.88546 +   1.72871i,   -0.88546 -   1.72871i,
  0.88418 +   0.00000i
 15.00000 +   0.00000i,   -5.78077 +   0.00000i,   -1.28854 +   4.81809i,
 -1.28854 -   4.81809i,    2.58466 +   0.00000i,   -0.75862 +   2.06551i,
 -0.75862 -   2.06551i
 16.00000 +   0.00000i,   -5.29346 +   0.00000i,   -0.94129 +   5.04363i,
 -0.94129 -   5.04363i,    2.71209 +   0.00000i,   -0.74314 +   2.22660i,
 -0.74314 -   2.22660i
 17.00000 +   0.00000i,   -0.96325 +   5.43042i,   -0.96325 -   5.43042i,
 -3.83949 +   0.00000i,    2.41368 +   0.00000i,   -0.98277 +   1.86790i,
 -0.98277 -   1.86790i
 18.00000 +   0.00000i,   -1.15844 +   5.52255i,   -1.15844 -   5.52255i,
 -3.36773 +   0.00000i,    2.20706 +   0.00000i,   -1.15196 +   1.53500i,
 -1.15196 -   1.53500i
 19.00000 +   0.00000i,   -0.93302 +   5.43235i,   -0.93302 -   5.43235i,
 -4.28644 +   0.00000i,    2.78350 +   0.00000i,   -0.92041 +   2.01410i,
 -0.92041 -   2.01410i
 20.00000 +   0.00000i,   -5.72653 +   0.00000i,   -0.95713 +   5.33069i,
 -0.95713 -   5.33069i,    3.26973 +   0.00000i,   -0.76582 +   2.24583i,
 -0.76582 -   2.24583i

***  時間(計有一組)，特徵值的虛數值(計有六組)，合計共有七組實數值 ***
  (特徵值的虛數值即角頻率，係依據特徵值的絕對值[模數 Modulus]，由大致小排序而成)
  0.00000    3.37745   -3.37745    3.61083   -3.61083    1.52681   -1.52681
  1.00000    2.87514   -2.87514    3.58851   -3.58851    1.95302    -1.95302
  2.00000    2.98608   -2.98608    3.42431   -3.42431    2.20875   -2.20875
  3.00000    3.34401   -3.34401    3.78510   -3.78510    1.81984    -1.81984
  4.00000    3.70145   -3.70145    3.90537   -3.90537    1.45004    -1.45004
  5.00000    3.77624   -3.77624    3.97058   -3.97058    1.74462    -1.74462
  6.00000    3.81551   -3.81551    4.26442   -4.26442    2.05116    -2.05116
  7.00000    4.02288   -4.02288    4.49039   -4.49039    1.95020    -1.95020
  8.00000    4.21289   -4.21289    4.25208   -4.25208    1.59671    -1.59671
  9.00000    3.86498   -3.86498    3.90293   -3.90293    1.48003    -1.48003
 10.00000    3.26497   -3.26497    3.50364   -3.50364    1.80711    -1.80711
 11.00000    2.81192   -2.81192    3.06483   -3.06483    2.11202    -2.11202
 12.00000    3.06109   -3.06109    3.09674   -3.09674    1.77316    -1.77316
 13.00000    3.29191   -3.29191    3.27430   -3.27430    1.33906    -1.33906
 14.00000    4.61481   -4.61481    0.00000    1.72871   -1.72871    0.00000 
 15.00000    0.00000    4.81809   -4.81809    0.00000    2.06551    -2.06551
 16.00000    0.00000    5.04363   -5.04363    0.00000    2.22660    -2.22660
 17.00000    5.43042   -5.43042    0.00000    0.00000    1.86790    -1.86790
 18.00000    5.52255   -5.52255    0.00000    0.00000    1.53500    -1.53500
 19.00000    5.43235   -5.43235    0.00000    0.00000    2.01410    -2.01410
 20.00000    0.00000    5.33069   -5.33069    0.00000    2.24583    -2.24583

時間序列:  t
   0.0000,    1.0000,    2.0000,    3.0000,    4.0000,
   5.0000,    6.0000,    7.0000,    8.0000,    9.0000,
  10.0000,   11.0000,   12.0000,   13.0000,   14.0000,
  15.0000,   16.0000,   17.0000,   18.0000,   19.0000,
  20.0000,

角頻率序列w0
   3.3774,    2.8751,    2.9861,    3.3440,    3.7015,
   3.7762,    3.8155,    4.0229,    4.2129,    3.8650,
   3.2650,    2.8119,    3.0611,    3.2919,    4.6148,
   0.0000,    0.0000,    5.4304,    5.5225,    5.4323,
   0.0000,

角頻率序列w1
  -3.3774,   -2.8751,   -2.9861,   -3.3440,   -3.7015,
  -3.7762,   -3.8155,   -4.0229,   -4.2129,   -3.8650,
  -3.2650,   -2.8119,   -3.0611,   -3.2919,   -4.6148,
   4.8181,    5.0436,   -5.4304,   -5.5225,   -5.4323,
   5.3307,

角頻率序列w2
   3.6108,    3.5885,    3.4243,    3.7851,    3.9054,
   3.9706,    4.2644,    4.4904,    4.2521,    3.9029,
   3.5036,    3.0648,    3.0967,    3.2743,    0.0000,
  -4.8181,   -5.0436,    0.0000,    0.0000,    0.0000,
  -5.3307,

角頻率序列w3
  -3.6108,   -3.5885,   -3.4243,   -3.7851,   -3.9054,
  -3.9706,   -4.2644,   -4.4904,   -4.2521,   -3.9029,
  -3.5036,   -3.0648,   -3.0967,   -3.2743,    1.7287,
   0.0000,    0.0000,    0.0000,    0.0000,    0.0000,
   0.0000,

角頻率序列w4
   1.5268,    1.9530,    2.2088,    1.8198,    1.4500,
   1.7446,    2.0512,    1.9502,    1.5967,    1.4800,
   1.8071,    2.1120,    1.7732,    1.3391,   -1.7287,
   2.0655,    2.2266,    1.8679,    1.5350,    2.0141,
   2.2458,

角頻率序列w5
  -1.5268,   -1.9530,   -2.2088,   -1.8198,   -1.4500,
  -1.7446,   -2.0512,   -1.9502,   -1.5967,   -1.4800,
  -1.8071,   -2.1120,   -1.7732,   -1.3391,    0.0000,
  -2.0655,   -2.2266,   -1.8679,   -1.5350,   -2.0141,
  -2.2458,

請按任意鍵繼續 . . .
*/  
